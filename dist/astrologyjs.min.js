!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("https"),require("http")):"function"==typeof define&&define.amd?define(["exports","https","http"],n):n(t.astrologyjs=t.astrologyjs||{},t.https,t.http)}(this,function(t,n,e){"use strict";function r(t,n){return n={exports:{}},t(n,n.exports),n.exports}n="default"in n?n["default"]:n,e="default"in e?e["default"]:e;var a=(function(){function t(t){this.value=t}function n(n){function e(t,n){return new Promise(function(e,a){var s={key:t,arg:n,resolve:e,reject:a,next:null};l?l=l.next=s:(o=l=s,r(t,n))})}function r(e,o){try{var l=n[e](o),s=l.value;s instanceof t?Promise.resolve(s.value).then(function(t){r("next",t)},function(t){r("throw",t)}):a(l.done?"return":"normal",l.value)}catch(u){a("throw",u)}}function a(t,n){switch(t){case"return":o.resolve({value:n,done:!0});break;case"throw":o.reject(n);break;default:o.resolve({value:n,done:!1})}o=o.next,o?r(o.key,o.arg):l=null}var o,l;this._invoke=e,"function"!=typeof n["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(t){return this._invoke("next",t)},n.prototype["throw"]=function(t){return this._invoke("throw",t)},n.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new n(t.apply(this,arguments))}},await:function(n){return new t(n)}}}(),function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),l=function(){function t(n,e,r,o){a(this,t),this.symbols={sun:"a",moon:"s",mercury:"d",venus:"f",earth:"g",mars:"h",jupiter:"j",saturn:"k",uranus:"ö",neptune:"ä",pluto:"#","south node":"?","north node":"ß",ceres:"A",pallas:"S",juno:"D",vesta:"F",lilith:"ç",cupido:"L",chiron:"l",nessus:"ò",pholus:"ñ",chariklo:"î",eris:"È",chaos:"Ê",fortuna:"%"},this.name=n,this.longitude=e,this.latitude=r,this.speed=o,this.symbol=this.symbols[n.toLowerCase()]}return o(t,[{key:"isRetrograde",value:function(){return this.speed<0}},{key:"isMajor",value:function(){return["sun","moon","mercury","venus","mars","jupiter","saturn","uranus","neptune","pluto","north node","south node"].indexOf(this.name.toLowerCase())>-1}}]),t}(),s=l,u={Planet:s},i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c=r(function(t,r){var a=n,o=function(t){var n=t.uri,e=Object.keys(t.qs).map(function(n){return encodeURIComponent(n)+"="+encodeURIComponent(t.qs[n].toString())}).join("&");return n+"?"+e},l=function(t){return new Promise(function(n,r){var l=e,s=t.uri.startsWith("https")?a:l,u=o(t),i=s.get(u,function(t){(t.statusCode<200||t.statusCode>299)&&r(new Error("HTTP Error: "+t.statusCode));var e=[];t.on("data",function(t){return e.push(t)}),t.on("end",function(){return n(JSON.parse(e.join("")))})});i.on("error",function(t){return r(t)})})};Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=l}),h=i&&i.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(a,o){function l(t){try{u(r.next(t))}catch(n){o(n)}}function s(t){try{u(r["throw"](t))}catch(n){o(n)}}function u(t){t.done?a(t.value):new e(function(n){n(t.value)}).then(l,s)}u((r=r.apply(t,n)).next())})},p=c,m=function(){function t(n,e,r){a(this,t),this.name=n,this.date=e,this.location=r}return o(t,null,[{key:"create",value:function(n,e,r){return h(this,void 0,void 0,regeneratorRuntime.mark(function a(){var o,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(o=void 0,l=void 0,n){a.next=3;break}throw new Error("No name was submitted for the person");case 3:if("string"!=typeof e){a.next=9;break}if(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(?::\d{2}\.\d{3})?Z/.test(e)){a.next=6;break}throw new TypeError("Date not formatted according to ISO 8601 (YYYY-MM-DDTHH:mmZ)");case 6:o=e,a.next=10;break;case 9:o=e instanceof Date?e.toISOString():(new Date).toISOString();case 10:if("string"!=typeof r){a.next=16;break}return a.next=13,this.getLatLon(r);case 13:l=a.sent,a.next=21;break;case 16:if(!(r.lat<-90||r.lat>90)){a.next=18;break}throw new RangeError("Latitude must be between -90 and 90");case 18:if(!(r.lng<-180||r.lng>180)){a.next=20;break}throw new RangeError("Longitude must be between -180 and 180");case 20:l=r;case 21:return a.abrupt("return",new t(n,o,l));case 22:case"end":return a.stop()}},a,this)}))}},{key:"getTimezone",value:function(t){return h(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p["default"]({uri:"https://maps.googleapis.com/maps/api/timezone/json",qs:{key:this._key,location:t.lat+","+t.lng,timestamp:Math.floor(Date.now()/1e3)}}).then(function(t){return t.timeZoneId},function(t){throw Error(t.errorMessage)});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"getLatLon",value:function(t){return h(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p["default"]({uri:"https://maps.googleapis.com/maps/api/geocode/json",qs:{key:this._key,address:t}}).then(function(t){return t.results[0].geometry.location},function(t){throw Error(t.error_message)});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}}]),t}();m._key="AIzaSyAXnIdQxap1WQuzG0XxHfYlCA5O9GQyvuY";var d=m,f={Person:d},y=function(){function t(n,e){a(this,t),this.p1=n,this.p2=e,this._types={conjunct:{major:!0,angle:0,orb:6,symbol:"<"},semisextile:{major:!1,angle:30,orb:3,symbol:"y"},decile:{major:!1,angle:36,orb:1.5,symbol:">"},novile:{major:!1,angle:40,orb:1.9,symbol:"M"},semisquare:{major:!1,angle:45,orb:3,symbol:"="},septile:{major:!1,angle:51.417,orb:2,symbol:"V"},sextile:{major:!0,angle:60,orb:6,symbol:"x"},quintile:{major:!1,angle:72,orb:2,symbol:"Y"},bilin:{major:!1,angle:75,orb:.9,symbol:"-"},binovile:{major:!1,angle:80,orb:2,symbol:";"},square:{major:!0,angle:90,orb:6,symbol:"c"},biseptile:{major:!1,angle:102.851,orb:2,symbol:"N"},tredecile:{major:!1,angle:108,orb:2,symbol:"X"},trine:{major:!0,angle:120,orb:6,symbol:"Q"},sesquiquadrate:{major:!1,angle:135,orb:3,symbol:"b"},biquintile:{major:!1,angle:144,orb:2,symbol:"C"},inconjunct:{major:!1,angle:150,orb:3,symbol:"n"},treseptile:{major:!1,angle:154.284,orb:1.1,symbol:"B"},tetranovile:{major:!1,angle:160,orb:3,symbol:":"},tao:{major:!1,angle:165,orb:1.5,symbol:"—"},opposition:{major:!0,angle:180,orb:6,symbol:"m"}};var r=n.longitude,o=e.longitude,l=Math.abs(r-o),s=n.isRetrograde(),u=e.isRetrograde(),i=Math.abs(n.speed),c=Math.abs(e.speed),h=!1;l>180+this._types.opposition.orb&&(l=r>o?360-r+o:360-o+r,h=!0);for(var p in this._types){var m=this._types[p];l>=m.angle-m.orb&&l<=m.angle+m.orb&&(this._type=p)}if("undefined"==typeof this._type)throw new Error("There is no aspect between these two planets.");this._orb=Number((l%1).toFixed(6));var d=l-this._types[this._type].angle;this._applying=(0>d&&!h&&o>r||d>0&&!h&&r>o||0>d&&h&&r>o||d>0&&h&&o>r)&&(!s&&!u&&c>i||s&&u&&i>c||s&&!u)||(d>0&&!h&&o>r||0>d&&!h&&r>o||d>0&&h&&r>o||0>d&&h&&o>r)&&(!s&&!u&&i>c||s&&u&&c>i||!s&&u)?!0:!1}return o(t,[{key:"isApplying",value:function(){return this._applying}},{key:"isMajor",value:function(){return this._types[this._type].major}},{key:"type",get:function(){return this._type}},{key:"orb",get:function(){return this._orb}},{key:"symbol",get:function(){return this._types[this._type].symbol}}]),t}(),g=y,b={Aspect:g},v=i&&i.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(a,o){function l(t){try{u(r.next(t))}catch(n){o(n)}}function s(t){try{u(r["throw"](t))}catch(n){o(n)}}function u(t){t.done?a(t.value):new e(function(n){n(t.value)}).then(l,s)}u((r=r.apply(t,n)).next())})},w=j,C=c,_=function(){function t(){a(this,t)}return o(t,null,[{key:"create",value:function(n,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.ChartType.Basic;return v(this,void 0,void 0,regeneratorRuntime.mark(function o(){var l,s,u;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(null!==n&&"undefined"!=typeof n&&0!==n.length){o.next=2;break}throw Error("Chart must have a name (ChartFactory)");case 2:if(null!==e&&"undefined"!=typeof e){o.next=4;break}throw Error("Person cannot be null or undefined (ChartFactory)");case 4:o.t0=a,o.next=o.t0===w.ChartType.Synastry?7:o.t0===w.ChartType.Combined?7:o.t0===w.ChartType.CombinedTransits?7:o.t0===w.ChartType.Davison?7:9;break;case 7:if(null!==r){o.next=9;break}throw Error("2nd Person cannot be null for this chart type (ChartFactory)");case 9:l=[],s=void 0,u=void 0,o.t1=a,o.next=o.t1===w.ChartType.Transits?13:o.t1===w.ChartType.Synastry?17:o.t1===w.ChartType.Combined?17:o.t1===w.ChartType.CombinedTransits?21:o.t1===w.ChartType.Davison?25:o.t1===w.ChartType.DavisonTransits?33:39;break;case 13:return o.next=15,Promise.all([t.getChartData(e.date,e.location),t.getChartData((new Date).toISOString(),e.location)]);case 15:return l=o.sent,o.abrupt("return",new w.Chart(n,e,l,null,a));case 17:return o.next=19,Promise.all([t.getChartData(e.date,e.location),t.getChartData(r.date,r.location)]);case 19:return l=o.sent,o.abrupt("return",new w.Chart(n,e,l,null,a));case 21:return o.next=23,Promise.all([t.getChartData(e.date,e.location),t.getChartData(r.date,r.location),t.getChartData((new Date).toISOString(),e.location)]);case 23:return l=o.sent,o.abrupt("return",new w.Chart(n,e,l,null,a));case 25:return s=t.getDatetimeMidpoint(e.date,r.date),u=t.getGeoMidpoint(e.location,r.location),o.t2=l,o.next=30,t.getChartData(s,u);case 30:return o.t3=o.sent,o.t2.push.call(o.t2,o.t3),o.abrupt("return",new w.Chart(n,e,l));case 33:return s=t.getDatetimeMidpoint(e.date,r.date),u=t.getGeoMidpoint(e.location,r.location),o.next=37,Promise.all([t.getChartData(s,u),t.getChartData((new Date).toISOString(),u)]);case 37:return l=o.sent,o.abrupt("return",new w.Chart(n,e,l,null,a));case 39:return o.t4=l,o.next=42,t.getChartData(e.date,e.location);case 42:return o.t5=o.sent,o.t4.push.call(o.t4,o.t5),o.abrupt("return",new w.Chart(n,e,l));case 45:case"end":return o.stop()}},o,this)}))}},{key:"getGeoMidpoint",value:function(n,e){var r=t.toRadians(n.lat),a=t.toRadians(n.lng),o=t.toRadians(e.lat),l=t.toRadians(e.lng),s=Math.cos(o)*Math.cos(l-a),u=Math.cos(o)*Math.sin(l-a),i=a+Math.atan2(u,Math.cos(r)+s),c=Math.atan2(Math.sin(r)+Math.sin(o),Math.sqrt(Math.pow(Math.cos(r)+s,2)+Math.pow(u,2)));return{lat:t.toDegrees(c),lng:t.toDegrees(i)}}},{key:"getDatetimeMidpoint",value:function(t,n){var e=new Date(t).getTime(),r=new Date(n).getTime(),a=void 0;return e===r?t:(a=r>e?e+(r-e)/2:r+(e-r)/2,new Date(a).toISOString())}},{key:"getChartData",value:function(t,n){return v(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C["default"]({uri:"http://www.morphemeris.com/ephemeris.php",qs:{date:t,lat:n.lat,lon:n.lng}}).then(function(t){return t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}}]),t}();_.toRadians=function(t){return t*Math.PI/180},_.toDegrees=function(t){return 180*t/Math.PI};var k=_,x={ChartFactory:k},j=r(function(t,n){var e=i&&i.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(a,o){function l(t){try{u(r.next(t))}catch(n){o(n)}}function s(t){try{u(r["throw"](t))}catch(n){o(n)}}function u(t){t.done?a(t.value):new e(function(n){n(t.value)}).then(l,s)}u((r=r.apply(t,n)).next())})},r=u,l=b,s=x;!function(t){t[t.Basic=0]="Basic",t[t.Transits=1]="Transits",t[t.Synastry=2]="Synastry",t[t.Combined=3]="Combined",t[t.Davison=4]="Davison",t[t.CombinedTransits=5]="CombinedTransits",t[t.DavisonTransits=6]="DavisonTransits"}(n.ChartType||(n.ChartType={}));var c=n.ChartType,h=function(){function t(n,e,r,o){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c.Basic;a(this,t),this.name=n,this.p1=e,this.p2=o,this.type=l,this._debug=!1,this._signs=[{name:"aries",symbol:"q",v:1},{name:"taurus",symbol:"w",v:1},{name:"gemini",symbol:"e",v:1},{name:"cancer",symbol:"r",v:1},{name:"leo",symbol:"t",v:1},{name:"virgo",symbol:"z",v:1},{name:"libra",symbol:"u",v:1},{name:"scorpio",symbol:"i",v:1},{name:"sagittarius",symbol:"o",v:1},{name:"capricorn",symbol:"p",v:1},{name:"aquarius",symbol:"ü",v:1},{name:"pisces",symbol:"+",v:1}];var s=void 0;switch(l){case c.Combined:s=this.calculateCombinedPlanets(r),this._planets1=this.getPlanets(s),this._ascendant=s.ascendant,this._houses=s.houses;break;case c.CombinedTransits:s=this.calculateCombinedPlanets(r),this._planets1=this.getPlanets(s),this._planets2=this.getPlanets(r[2]),this._ascendant=s.ascendant,this._houses=s.houses;break;default:this._planets1=this.getPlanets(r[0]),r[1]&&(this._planets2=this.getPlanets(r[1])),this._ascendant=r[0].ascendant,this._houses=r[0].houses}this.calculateAspects()}return o(t,[{key:"getPlanets",value:function(t){var n=[];for(var e in t.planets){var a=t.planets[e];n.push(new r.Planet(a.name,a.lon,a.lat,a.spd))}return n}},{key:"calculateAspects",value:function(){if(this._aspects=[],this._planets2)for(var t in this._planets1)for(var n in this._planets2)try{this._aspects.push(new l.Aspect(this._planets1[t],this._planets2[n]))}catch(e){this._debug&&console.error(e)}else for(var r in this._planets1)for(var a in this._planets1)if(r!==a&&a>r)try{this._aspects.push(new l.Aspect(this._planets1[r],this._planets1[a]))}catch(e){this._debug&&console.error(e)}}},{key:"calculateCombinedPlanets",value:function(t){var n={planets:{sun:{name:null,lon:null,lat:null,spd:null,r:null},moon:{name:null,lon:null,lat:null,spd:null,r:null},mercury:{name:null,lon:null,lat:null,spd:null,r:null},venus:{name:null,lon:null,lat:null,spd:null,r:null},mars:{name:null,lon:null,lat:null,spd:null,r:null},jupiter:{name:null,lon:null,lat:null,spd:null,r:null},saturn:{name:null,lon:null,lat:null,spd:null,r:null},uranus:{name:null,lon:null,lat:null,spd:null,r:null},neptune:{name:null,lon:null,lat:null,spd:null,r:null},pluto:{name:null,lon:null,lat:null,spd:null,r:null},"north node":{name:"north node",lon:null,lat:null,spd:null,r:null},"south node":{name:"south node",lon:null,lat:null,spd:null,r:null},chiron:{name:null,lon:null,lat:null,spd:null,r:null},pholus:{name:null,lon:null,lat:null,spd:null,r:null},ceres:{name:null,lon:null,lat:null,spd:null,r:null},pallas:{name:null,lon:null,lat:null,spd:null,r:null},juno:{name:null,lon:null,lat:null,spd:null,r:null},vesta:{name:null,lon:null,lat:null,spd:null,r:null},cupido:{name:null,lon:null,lat:null,spd:null,r:null},chariklo:{name:null,lon:null,lat:null,spd:null,r:null},chaos:{name:null,lon:null,lat:null,spd:null,r:null},eris:{name:null,lon:null,lat:null,spd:null,r:null},nessus:{name:null,lon:null,lat:null,spd:null,r:null}},houses:[null,null,null,null,null,null,null,null,null,null,null,null],ascendant:null,mc:null};for(var e in t[0].planets)n.planets[e].name=e,n.planets[e].lon=this.getLonMidpoint(t[0].planets[e].lon,t[1].planets[e].lon),n.planets[e].lat=(t[0].planets[e].lat+t[1].planets[e].lat)/2,n.planets[e].spd=(t[0].planets[e].spd+t[1].planets[e].spd)/2;for(var r in t[0].houses)n.houses[r]=this.getLonMidpoint(t[0].houses[r],t[1].houses[r]);return n.ascendant=this.getLonMidpoint(t[0].ascendant,t[1].ascendant),n.mc=this.getLonMidpoint(t[0].mc,t[1].mc),n}},{key:"getLonMidpoint",value:function(t,n){var e=void 0,r=void 0,a=void 0;return t===n?t:(r=t>n?t:n,a=n>t?t:n,e=180>=r-a?(r+a)/2:((a+360-r)/2+r)%360)}},{key:"refreshTransits",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e(this,void 0,void 0,regeneratorRuntime.mark(function n(){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(c.Synastry!==this.type){n.next=2;break}throw new Error("You cannot refresh transits on a synastry chart");case 2:return null===t&&(t=(new Date).toISOString()),n.next=5,s.ChartFactory.getChartData(t,this.p1.location);case 5:e=n.sent,this._planets2=this.getPlanets(e),this.calculateAspects();case 8:case"end":return n.stop()}},n,this)}))}},{key:"houses",get:function(){return this._houses}},{key:"aspects",get:function(){return this._aspects}},{key:"ascendant",get:function(){return this._ascendant}},{key:"innerPlanets",get:function(){return this._planets2?this._planets1:[]}},{key:"outerPlanets",get:function(){return this._planets2?this._planets2:this._planets1}}]),t}();n.Chart=h}),D=u,P=D.Planet,T=f,M=T.Person,S=b,R=S.Aspect,I=j,q=I.Chart,O=I.ChartType,A=x,E=A.ChartFactory,L={Planet:P,Person:M,Aspect:R,Chart:q,ChartType:O,ChartFactory:E};t["default"]=L,t.Planet=P,t.Person=M,t.Aspect=R,t.Chart=q,t.ChartType=O,t.ChartFactory=E,Object.defineProperty(t,"__esModule",{value:!0})});